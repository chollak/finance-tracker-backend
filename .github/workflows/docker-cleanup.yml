name: Docker Cleanup

on:
  schedule:
    # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 4:00 UTC (9:00 –ø–æ –¢–∞—à–∫–µ–Ω—Ç—É)
    - cron: '0 4 * * *'
  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–∑ GitHub
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest

    steps:
      - name: Docker cleanup on server
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          port: 22
          timeout: 60s
          command_timeout: 5m
          script: |
            echo "=========================================="
            echo "üïê Docker Cleanup: $(date '+%Y-%m-%d %H:%M:%S')"
            echo "=========================================="

            echo ""
            echo "üìä BEFORE cleanup:"
            echo "------------------------------------------"
            docker system df
            df -h / | tail -1

            echo ""
            echo "üßπ Running cleanup..."
            echo "------------------------------------------"
            docker system prune -af
            docker builder prune -af

            echo ""
            echo "üìä AFTER cleanup:"
            echo "------------------------------------------"
            docker system df
            df -h / | tail -1

            echo ""
            echo "‚úÖ Cleanup complete!"
            echo "=========================================="
